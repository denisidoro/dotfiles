#!/usr/bin/env bash
set -euo pipefail

PROJ_BIN="${DOTFILES}/target/dotrs"
RELEASE_PATH="target/release/dotrs"
DEBUG_PATH="target/debug/dotrs"

_bin() {
  if [ -f "$PROJ_BIN" ]; then
   echo "$PROJ_BIN"
   return 0
  elif [ -f "$RELEASE_BIN" ]; then
   echo "$RELEASE_BIN"
   return 0
  else [ -f "$DEBUG_BIN" ]; then
   echo "$DEBUG_BIN"
   return 0
   fi
   return 1
}

_help() {
   echo "Calls Rust commands

Usage:
   call <script>"
   exit 0
}

cmd="${1:-}"
shift

case "$cmd" in
   --help|-h) _help ;;
esac

bin_path="$(_bin)"
if [ -n "$bin_path" ]; then
   _bin_path "$cmd" "$@"
   exit 0
fi

dot pkg add dotrs || true
bin_path="$(_bin)"
if [ -n "$bin_path" ]; then
   _bin_path "$cmd" "$@"
   exit 0
fi
