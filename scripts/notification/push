#!/usr/bin/env bash
set -euo pipefail

source "${DOTFILES}/scripts/core/main.sh"

##? Pushbullet API
#?? 0.1.0
##?
##? Usage:
##?    push list
##?    push <device> note <title> [<message>]
##?    push <device> link <url>
##?    push <device> link <title> <url>
##?    push <device> link <title> <message> <url>
##?    push -- <args>...
##?
##? Examples:
##?    push list
##?    push -- list
##?    push moto note title message
##?    push moto link http://google.com
##?    push moto link title message http://google.com

docs::eval "$@"

PUSHBULLET_HOME="${PUSHBULLET_HOME:-${DOTFILES}/modules/pushbullet}"
PUSHBULLET_BIN="${PUSHBULLET_HOME}/pushbullet"

# clone repository if needed
if ! fs::is_file "$PUSHBULLET_BIN"; then
   dot pkg pushbullet-bash
fi

# adapt input
if $note || $link; then
   args=("push" "${@:-}")
else
   args="${@:-}"
fi

# call cli
bash "$PUSHBULLET_BIN" "${args[@]:-}"
